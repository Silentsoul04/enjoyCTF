angular['module']('json', [
    'ngCookies'
])['controller']('loginController', [
    '$http',
    '$scope',
    '$cookies',
    function(http, scope, cookies) {
        scope['credentials'] = {
            UserName: '',
            Password: ''
        };
        scope['error'] = {
            message: '',
            show: false
        };
        var flag = cookies['get']('OAuth2');
        if (flag) {
            window['location']['href'] = 'index.html'
        };
        scope['login'] = function() {
            http['post']('/api/token', scope['credentials'])['then'](function(result) {
                window['location']['href'] = 'index.html'
            }, function(msg) {
                scope['error']['message'] = 'Invalid Credentials.';
                scope['error']['show'] = true;
                console['log'](msg)
            })
        }
    }
])['controller']('principalController', [
    '$http',
    '$scope',
    '$cookies',
    function(http, scope, cookies) {
        var flag = cookies['get']('OAuth2');
        if (flag) {
            http['get']('/api/Account/', {
                headers: {
                    'Bearer': flag
                }
            })['then'](function(result) {
                scope['UserName'] = result['data']['Name']
            }, function(msg) {
                cookies['remove']('OAuth2');
                window['location']['href'] = 'login.html'
            })
        } else {
            window['location']['href'] = 'login.html'
        }
    }
])
